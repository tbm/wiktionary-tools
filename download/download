#!/usr/bin/env python3

"""
Download pages
"""

import re
from pathlib import Path
import sys

import click
import pywikibot

import kamusi


@click.command()
@click.option("--lang", type=str, required=True, help="Language code")
@click.option("--out", type=click.Path(), required=True, help="Directory for output")
def download(lang, out):
    """
    Downlodad lemmas and store them in a directory
    """
    out = Path(out)
    Path.mkdir(out, exist_ok=True)
    site = pywikibot.Site("en", "wiktionary")
    lemmas = pywikibot.Category(site, kamusi.code_to_name(lang) + "_lemmas")
    for page in lemmas.articles():
        print(page.title())
        text = kamusi.get_entry(page.text, lang, strip=True)
        if not text:
            print("Can't get entry for", page.title())
            continue
        outfile = out / Path(page.title().replace("/", "_"))
        with open(outfile, "w", encoding="utf-8") as outfile:
            print(text, file=outfile)


if __name__ == "__main__":
    download()  # pylint: disable=no-value-for-parameter
