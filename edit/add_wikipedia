#!/usr/bin/env python3

"""
Add Wikipedia link to Wiktionry entry
"""

import sys

import click
import pywikibot
import requests
import kamusi


@click.command()
@click.argument("page")
@click.option("--lang", default="sw", help="Language code")
def add_wikipedia_page(page, lang):
    """
    Add Wikipedia link to page
    """
    wp = requests.head(
        f"https://{lang}.wikipedia.org/wiki/{page.capitalize()}", timeout=5
    )
    if not wp.ok:
        print("Wikipedia page doesn't exist")
        sys.exit(1)
    site = pywikibot.Site("en", "wiktionary")
    page = pywikibot.Page(site, page)
    text = kamusi.add_wikipedia(page.text, lang)
    if not text:
        print(f"No page {page} for language {lang}")
        sys.exit(1)
    if page.text == text:
        print("No change")
        sys.exit(1)
    changelog = f"/* {kamusi.lang_map[lang]} */ Add link to Wikipedia"
    print(text)
    edit = input("Store edit (Y/n): ")
    if not edit.upper() == "N":
        page.text = text
        page.save(changelog, minor=False)


if __name__ == "__main__":
    add_wikipedia_page()  # pylint: disable=no-value-for-parameter
